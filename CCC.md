====== 1 s-HR集成概述 ======
====== 1 s-HR集成概述 ======
===== 1.1 概述 =====
s-HR集成主要用于同时购买了金蝶云星空与s-HR的，并需要s-HR数据集成到金蝶云星空客户。s-HR集成可以将s-HR相关基础数据以及薪资发放结果，从s-HR定时自动同步到金蝶云星空，进而保持部门、岗位、员工基础资料的统一，以及人力资源薪酬管理人员完成薪资核算后，可以快速将薪资核算结果结转至总账系统进行成本凭证处理。保障整个业务系统的信息流连贯通畅，及全程的自动化处理。主要功能如下：

**基础资料初始化同步**

在金蝶云星空以及s-HR完成同步配置后，对s-HR系统内的部门、岗位、员工、员工任岗等基础资料进行首次初始化同步操作。s-HR系统将会将系统内当前有效的部门、有效的岗位、仍然在职的员工及其任岗的信息数据进行初始化。

**部门、岗位、员工、员工任岗基础资料同步**

s-HR系统在业务运行中，对部门、岗位、员工、员工任岗等新增、变更操作时，可以在变更后实时向金蝶云星空进行变更同步，刷新数据。

**薪资发放结果同步**

s-HR系统完成薪资核算结果并审批完成后，在薪资发放模块点击【提交财务系统】，将薪资核算明细自动同步到金蝶云星空财务系统内。金蝶云星空财务系统将通过智能会计平台配置好的工资费用成本凭证模板进行相应的账务处理。

===== 1.2 特性 =====
s-HR集成提供了以下特色功能：
  - 保证组织部门、岗位、员工等基础资料的统一 ；
  - 支持实时自动同步数据，同步后的数据遵循基础资料控制策略控制；
  - 保障整个业务系统的信息流连贯通畅，及全程的自动化处理。


===== 1.3 使用前提 =====
  - 购买金蝶云星空 产品；
  - 购买s-HR以及与金蝶云星空集成接口。


===== 1.4 操作流程 =====
**第一步 集成准备工作**
  - 分别安装s-HR和金蝶云星空 建议使用不同的服务器安装产品，因为两个产品对服务器的要求不同；
  - 金蝶云星空的组织架构  两个产品无论上线时间先后，要求组织机构分别在两个产品中各自维护，且需要同步的组织机构编码是一致；
  - s-HR数据维护   s-HR所有组织的【金蝶云星空业务组织编码】字段必须维护为“100”，否则s-HR数据无法同步。

**第二步 集成配置**


集成配置方式：通过WEB API方式实现s-HR与金蝶云星空的数据同步，保证数据集成的效率，且更加稳定。

集成配置请参考s-HR集成配置章节的介绍，包括金蝶s-HR系统与金蝶云星空系统的集成配置。

**第三步 同步数据**
  - 首次配置集成并已经保存配置参数，则点击参数界面中的【同步】按键来进行首次的初始化操作，执行【同步】后， s-HR自动将选择数据同步到金蝶云星空；
  - 后续s-HR的数据有调整，也会自动同步。具体功能的使用特点在s-HR人事基础资料同步和 s-HR薪资发放结果同步章节中详细说明。

====== 2 s-HR集成配置 ======
=====  2.1	WEB API操作流程 =====

====  2.1.1	金蝶云星空启用集成 ====

Administrator登录金蝶云星空系统，【系统管理】->【s-HR集成】->【s-HR集成配置】，打开s-HR集成配置界面，按下面流程操作：

  - 填写同步用户，此用户作为金蝶云星空和s-HR同步的用户，必须具有s-HR同步基础资料的新增权限；
  - 填写s-HR接口地址，此接口是金蝶s-HR产品发布的用于集成的接口地址，直接修改s-HR的地址和端口号即可；
  - 点击【启用】，启用s-HR集成配置；
  - 点击【引出密钥文件】，引出密钥文件，引出文件名称不要修改；
需要重新引出密钥文件的场景：1）修改用户；2）修改s-HR接口地址；3）重置密钥。



====  2.1.2 s-HR启用集成及初始化 ====

Administrator登录s-HR系统，【开发平台】->【集成配置】->【金蝶云星空集成配置】，打开金蝶云星空集成配置界面，按下面流程操作：

  - 配置消息接口服务地址，即金蝶云星空访问地址；直接修改金蝶云星空地址和端口号即可；
  - 引入密钥文件，作为登录金蝶云星空的安全访问文件，该文件按2.1 .1-4金蝶云星空启用配置中步骤中获取，引入s-HR系统即可；
  - 选择同步内容，根据需要勾选启用基础资料同步集成接口或者启用薪资发放结果同步集成接口，同步相应数据；
  - 执行同步，点击【同步】，系统自动进行初始化同步数据，并完成后刷新状态为“已初始化”；
  - 查看同步情况，在金蝶云星空和s-HR系统均可以查看同步数据的同步日志和映射关系表，具体见2.1.5查看同步情况章节的描述。
====  2.1.3 自动执行s-HR集成 ====

后续s-HR的数据有调整，也会自动同步。具体功能的使用特点在s-HR人事基础资料同步和 s-HR薪资发放结果同步章节中详细说明。

====  2.1.4 金蝶云星空 强制同步 ====

**功能描述**

通过强制更新操作，可以让客户自行决定是否从s-HR强行刷新数据，以免对历史数据产生影响。

比如：金蝶云星空已存在员工0010张三（金蝶云星空手工新增），使用金蝶云星空岗位（业务员，上级是业务组长）进行审批流业务处理，且流程没有结束，s-HR上线后，维护员工0010张三的岗位（业务员，上级是部门经理），岗位上存在差异，如果自动同步则会造成金蝶云星空的审批流提交不正确。提供强制更新，可以让客户自行选择是否按照s-HR的员工0010张三的数据强行覆盖金蝶云星空同一编码0010张三的数据。

**功能路径**

【部门/岗位/员工/员工任岗】的【s-HR同步】->【强制更新s-HR数据】菜单

**操作步骤**

以员工（张三，编码001）为例描述：
1、登录s-HR系统，在员工信息维护001张三，同时按照HR的原则维护岗位；

2、通过正常的同步操作，该记录无法同步到金蝶云星空，提示说已经存在该编码的数据；

3、通过比对数据，发现HR是按照最新岗位要求维护的，而金蝶云星空是因为先使用而维护的岗位信息与现在管理要求不符，需要更新金蝶云星空数据与HR一致；

4、登录金蝶云星空系统，打开员工列表，选择001张三，点击【s-HR同步—>强制更新s-HR数据】，按s-HR的张三的数据刷新金蝶云星空的001张三，即金蝶云星空的001张三的岗位刷新为与HR一致（注意：s-HR和金蝶云星空的员工编码是相同的才可以强制同步）；

5、强制更新后，会返回同步结果信息，并可以查看日志和映射关系表，具体见2.1.5查看同步情况章节的描述。

**同步规则**

1、金蝶云星空与s-HR相同编码的数据按照s-HR的内容进行同步覆盖；

2、金蝶云星空强制同步时，需要从同步数据的顶层开始（主要是有上级关系的基础资料，例如：部门、岗位等），自上而下的级次顺序逐级选择记录进行。

====  2.1.5 查看同步情况 ====

**功能描述**

在金蝶云星空和s-HR系统均可以查看同步数据的同步日志和映射关系表。通过同步日志可以直观查看同步失败的原因，便于分析原因。通过映射关系的查看可以溯源。

1、s-HR系统所有资料的同步日志在同一菜单查看，功能路径：【开发平台】->【集成配置】->【金蝶云星空集成配置同步日志】；

2、金蝶云星空系统针对具体的s-HR基础资料分别查看，功能路径：【部门/岗位/员工/员工任岗】的【s-HR同步】->【s-HR同步日志】菜单；

3、s-HR同步日志记录同步的类型、编码、名称、同步时间以及失败原因；

4、映射关系表记录同步记录的金蝶云星空 ID和s-HR ID，便于溯源。



===== 2.2 业务配置方案  =====
s-HR集成根据不同的业务场景有不同的操作步骤。

====  2.2.1 场景一：先上s-HR后上金蝶云星空  ====

1、金蝶云星空A进行s-HR集成配置，并启用，引出密钥文件；

2、 s-HR 1#在金蝶云星空集成配置中引入金蝶云星空 A密钥文件，填写消息地址，点击【同步】，系统进行初始化同步操作；

3、后续s-HR 1#的数据有异动，则系统会自动同步到金蝶云星空 A。

====  2.2.2 场景二：先上金蝶云星空后上s-HR ====  

1、金蝶云星空 B进行s-HR集成配置，并启用，引出密钥文件；

2、 s-HR 2#在金蝶云星空集成配置中引入金蝶云星空 B密钥文件，填写消息地址，点击【同步】，系统进行初始化同步操作；

3、初始化同步存在不能同步数据，需要根据同步日志检查：

  1）编码相同的，从业务层面决策是否需要与s-HR保持一致，如果保持一致是否会影响
       金蝶云星空的历史数据或者工作流之类的，确定后在金蝶云星空使用【强制更新s-HR数据】；
       
  2）编码不同名称相同的，则确定以谁为准进行修改，再按照1）进行处理；
  
4、金蝶云星空强制同步时，需要从同步数据的顶层开始，自上而下的级次顺序逐级选择记录进行操作。



====  2.2.4 场景三：多个客户的s-HR同步到金蝶云星空公有云的对应数据中心====  

1、公有云的金蝶云星空 D和E各自进行s-HR集成配置，并启用，引出密钥文件；

2、 客户甲s-HR 4#在金蝶云星空集成配置中引入金蝶云星空 D密钥文件，填写消息地址，点击【同步】，系统进行初始化同步操作；

3、后续客户甲s-HR 4#的数据有异动，则系统会自动同步到金蝶云星空 D。

4、客户乙按照步骤2和3进行同样的操作。

====  2.2.5 场景四：s-HR调整同步的账套 ====  

1、金蝶云星空 F在s-HR集成配置执行【停用】；

2、金蝶云星空 F手动执行脚本清除与s-HR 6#的数据映射关系，同步数据依然在金蝶云星空 F存在；

3、金蝶云星空 F重新启用，引出密钥文件；

4、 s-HR 7#在金蝶云星空集成配置中引入金蝶云星空 F密钥文件，填写消息地址，点击【同步】，系统进行初始化同步操作；

5、后续s-HR 7#的数据有异动，则系统会自动同步到金蝶云星空 F。

====  2.2.6 场景五：金蝶云星空调整同步的数据中心====  

1、 s-HR 8#手动执行脚本清除与金蝶云星空 G的数据映射关系；

3、金蝶云星空 H进行s-HR集成配置，并启用，引出密钥文件；

4、 s-HR 8#在金蝶云星空集成配置中引入金蝶云星空 H密钥文件，填写消息地址，点击【同步】，系统进行初始化同步操作；

5、后续s-HR 8#的数据有异动，则系统会自动同步到金蝶云星空 H。


====  2.2.7 场景六： 金蝶云星空调整同步的用户====  

1、 金蝶云星空 L在s-HR集成配置执行【停用】，修改用户为“李四”，点击【重置密钥】，重新引出密钥文件；

2、 s-HR 11#在金蝶云星空集成配置中重新引入金蝶云星空 L的新密钥文件，点击【同步】；

3、后续s-HR 11#的数据有异动，则系统会自动同步到金蝶云星空 L；

4、金蝶云星空站点的IP地址调整，也是重新执行步骤1和2，并且在2中修改消息地址。



====== 3 s-HR基础资料同步 ======
===== 3.1 使用前提 =====
1、s-HR系统中，对需要同步组织单元填入所属组织编码，如果不想同步该内容则填写默认值0；

   注意：s-HR是行政体系，而金蝶云星空是业务体系，两者在组织机构会是不完全一致的，请在同步前做好系统外的对应关系。

2、s-HR的系统集成配置界面，勾选【启用基础资料同步集成接口】选项。

===== 3.2 同步范围 =====
s-HR支持同步的基础资料，包含：部门、岗位、员工、员工任岗。

===== 3.3 同步规则 =====
  - s-HR的同步基础资料存在新增、修改、变更、封存、删除等操作后，会通过s-HR服务接口将变动数据的内容向金蝶云星空系统进行实时的自动同步；
  - 同步影响【来源=s-HR】的记录，金蝶云星空里可以手工维护部门、员工、岗位的；
  - s-HR基础资料已经同步到金蝶云星空的记录不允许在s-HR删除；
  - 同步时，不考虑记录在金蝶云星空的数据状态；
  - 同步数据会根据其在s-HR离职或者关闭等情况自动置为禁用状态；
  - 如果需要支持反禁用，可以在BOS IDE扩展后将反禁用的控制去掉；
  - API方式执行自动同步时，出现异常会自动轮回两次执行，再出现异常就不再执行。


===== 3.4 同步注意事项 =====
  - 此操作为异步操作，会有一定时间的延迟。若变更数据较多，则需要较长的同步时间。所以，变更后马上查看金蝶云星空系统时，有可能会出现无法查看到完整的变更数据。建议，等待一段时间后再查看同步结果。
  - 因为是变更实时同步，所以非常可能出现s-HR系统需要调整组织架构属性信息或组织架构层级关系。但是，财务业务或供应链业务在金蝶云星空系统中可能会仍然需要旧的部门组织信息或层级关系进行相关业务的处理。因此，建议进行良好的系统外的沟通工作，保障s-HR对组织架构的变更处理后，不会影响其他业务系统在金蝶云星空内的对相应部门基础资料的使用操作。
  - s-HR是支持基础资料变更名称业务操作（非名称错误的原因），这样就会造成对应同步到金蝶云星空的数据按照新名称显示历史数据，违反了历史业务留痕的原则，所以需要s-HR部门与业务部门对此协商，达成一致；建议：如果基于同步的情况下，该功能在s-HR谨慎使用。
  - s-HR的组织单元如果存在上级，需要上级组织也要填写所属组织编码，否则会造成组织单元无法同步到部门；
  - s-HR的员工、岗位、员工任岗都是在组织单元下面的，所以会根据其所属组织单元填写的所属组织编码进行同步。
 ====== 4 s-HR薪资发放结果同步 ======
===== 4.1 薪资期间设置 =====
**业务背景**
金蝶云星空总账系统对于需要凭证处理的业务单据上都要有财务日期，总账系统通过财务日期，来匹配相应组织下的会计期间。因此，也需要s-HR同步过来的薪资发放结果，也要有财务日期，以保证后续的凭证处理。

**操作说明**
  - s-HR的系统集成配置界面，勾选【启用薪资发放结果同步集成接口】选项，
  - 系统将自动增加一个【财务日期】字段。其在薪酬期间新增时，将按照对应薪酬期间的起止日期第一天作为此财务日期默认值。用户可以进行修改调整。

**注意事项**
  - 若需要同步薪资发放结果，则此财务日期字段必须填写。 
  - 建议此财务日期在系统外与财务人员沟通确认后，再修改调整为合适的财务日期。 
  - 财务日期在各个薪酬期间内允许重复，主要为了防止发放超过12期工资时，可以进入同一个会计期间的场景。

===== 4.2 薪资方案设置 =====
**业务背景**
在s-HR薪资核算发放结果向金蝶云星空系统进行同步时，需要明确当前这个方案的核算结果将作为哪个业务组织的业务数据进行同步。并且金蝶云星空的财务核算体系当中，每一个核算组织下挂了多个业务组织，这些业务组织的业务单据将根据这种核算隶属关系将业务数据传入对应的这个核算组织内。在这个核算组织内的总账内生成相应的业务凭证与总账凭证。因此，s-HR系统在核算薪资时，也必须要明确当前这个核算方案的核算结果需要作为金蝶云星空哪个业务组织的业务数据来进行核算。

**操作说明**
  - 在新建和维护薪酬方案的信息界面中，若勾选【启用薪资发放结果同步集成接口】选项，则方案设置界面中，会自动出现【总账业务组织编码】与【总账业务组织名称】字段，总账业务组织编码字段为必填。
  - 在薪酬方案中填写了总账业务组织编码字段后，在后续同步薪资发放结果时，金蝶云星空将根据此总账业务组织编码，将此方案下的薪资发放数据写入相应的金蝶云星空业务组织下，作为此业务组织的人工工资费用业务数据进行保留。最终按照此业务组织下的人工工资费用生成相应的业务凭证及总账费用凭证。

===== 4.3 同步薪资发放 =====
**使用前提**

s-HR薪资核算专员完成薪资数据的核算后，需要对最终发放数据进行HR审核标记。当标记审核通过后，才可以在s-HR系统向金蝶云星空总账系统进行提交操作处理。

**操作说明**
  - 勾选【启用薪资发放结果同步集成接口】后，在s-HR的薪资发放系统中会自动出现【提交财务系统】的工具栏。
  - 勾选已审核的薪资方案，点击【提交财务系统】。系统将自动发放消息给金蝶云星空系统，金蝶云星空系统接收到消息后，会通过集成服务接口读取相应薪资方案，相应期次内的薪资结果向金蝶云星空中进行同步。

**注意事项**
  - 必填要填写本期次对应薪酬期间上的财务日期字段内容，否则无法提交财务系统。 
  - 必须要填写薪酬方案上的总账业务组织编码和名称字段，否则无法提交财务系统。 
  - 【提交财务系统】按键受权限的控制，若启用参数后用户无法看到此按键或点击此按键，请联系系统管理员在用户管理中开放相应的功能权限即可。 
  - 【提交财务系统】只能对已审核的薪酬方案进行提交财务系统，未审核的薪酬方案则不能提交。 
  - 重复点击后，将重复发送提交消息给金蝶云星空系统。重复性判断将有金蝶云星空系统内自行决定是否需要处理。

====== 5 业务说明 ======
===== 5.1 s-HR同步基础资料的应用 =====

  - 同步基础资料类型在金蝶云星空可以手工新增，只是来源不同。
  - 同步数据的对应同步字段在金蝶云星空是不可编辑。
  - 同步数据在金蝶云星空可以加进行功能操作，如：提交、审核、反审核、删除等，但是不能进行禁用、反禁用操作。 
  - 部门、员工、岗位、员工任岗在金蝶云星空可以手工新增，只是来源不同，且不能引用s-HR同步过来的数据。

举例：s-HR同步了销售部这条部门数据，在金蝶云星空新增员工张三，是不能选到销售部这个部门的。

===== 5.2 s-HR同步薪资发放结果的应用 =====

  - 同步薪资发放界面默认不提供查看界面，只有在会计智能平台才可以选择；
  - 如果需要显示，可以通过BOS集成平台进行相应操作。
  - 薪资发放结果是部门级别，不涉及到个人级别，主要进行费用成本凭证的处理。
   例如：借：生产成本、管理费用、销售费用  贷：应付工资

===== 5.3 其他事项 =====

s-HR集成接口是需要购买的（无站点控制），收费事宜请咨询s-HR产品部。
  

  
